{"ast":null,"code":"import React,{useContext,useEffect,useRef,useState}from\"react\";import{useHistory}from\"react-router-dom\";import{Add as AddIcon}from\"@material-ui/icons\";import{makeStyles}from'@material-ui/core/styles';import Paper from'@material-ui/core/Paper';import SearchIcon from'@material-ui/icons/Search';import InputBase from'@material-ui/core/InputBase';import Tabs from'@material-ui/core/Tabs';import Tab from'@material-ui/core/Tab';import Badge from'@material-ui/core/Badge';import PlaylistAddCheckOutlinedIcon from'@material-ui/icons/PlaylistAddCheckOutlined';import GroupIcon from'@material-ui/icons/Group';import toastError from'../../errors/toastError';import api from'../../services/api';import{Snackbar,IconButton}from\"@material-ui/core\";import FormControlLabel from'@material-ui/core/FormControlLabel';import Switch from'@material-ui/core/Switch';import ChatIcon from'@material-ui/icons/Chat';import DoneAllIcon from'@material-ui/icons/DoneAll';import NewTicketModal from'../NewTicketModal';import TicketsList from'../TicketsListCustom';import TicketsListGroup from'../TicketsListGroup';import TabPanel from'../TabPanel';import{i18n}from'../../translate/i18n';import{AuthContext}from'../../context/Auth/AuthContext';import{Can}from'../Can';import TicketsQueueSelect from'../TicketsQueueSelect';import{Button,Grid}from'@material-ui/core';import{TagsFilter}from'../TagsFilter';import{UsersFilter}from'../UsersFilter';import{DatePickerMoment}from'../DatePickerMoment';//import NewTicketGroupModal from '../NewTicketGroup';\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({ticketsWrapper:{position:'relative',display:'flex',height:'100%',flexDirection:'column',overflow:'hidden',borderTopRightRadius:0,borderBottomRightRadius:0},tabsHeader:{flex:'none',backgroundColor:theme.palette.background.default},settingsIcon:{alignSelf:'center',marginLeft:'auto',padding:8},tab:{minWidth:60,width:60},ticketOptionsBox:{display:'flex',justifyContent:'space-between',alignItems:'center',backgroundColor:theme.palette.background.paper,padding:theme.spacing(1)},serachInputWrapper:{flex:1,backgroundColor:theme.palette.background.default,display:'flex',borderRadius:40,padding:4,marginRight:theme.spacing(1)},searchIcon:{color:theme.palette.primary.main,marginLeft:6,marginRight:6,alignSelf:'center'},searchInput:{flex:1,border:'none',borderRadius:25,outline:'none'},snackbar:{display:\"flex\",justifyContent:\"space-between\",backgroundColor:theme.palette.primary.main,color:\"white\",borderRadius:30,[theme.breakpoints.down(\"sm\")]:{fontSize:\"0.8em\"},[theme.breakpoints.up(\"md\")]:{fontSize:\"1em\"}},yesButton:{backgroundColor:\"#FFF\",color:\"rgba(0, 100, 0, 1)\",padding:\"4px 4px\",fontSize:\"1em\",fontWeight:\"bold\",textTransform:\"uppercase\",marginRight:theme.spacing(1),\"&:hover\":{backgroundColor:\"darkGreen\",color:\"#FFF\"},borderRadius:30},noButton:{backgroundColor:\"#FFF\",color:\"rgba(139, 0, 0, 1)\",padding:\"4px 4px\",fontSize:\"1em\",fontWeight:\"bold\",textTransform:\"uppercase\",\"&:hover\":{backgroundColor:\"darkRed\",color:\"#FFF\"},borderRadius:30},badge:{right:'-10px'},show:{display:'block'},hide:{display:'none !important'}}));const TicketsManagerTabs=()=>{const classes=useStyles();const history=useHistory();const[isHoveredAll,setIsHoveredAll]=useState(false);const[isHoveredNew,setIsHoveredNew]=useState(false);const[isHoveredResolve,setIsHoveredResolve]=useState(false);const[isHoveredOpen,setIsHoveredOpen]=useState(false);const[isHoveredClosed,setIsHoveredClosed]=useState(false);const[snackbarOpen,setSnackbarOpen]=useState(false);const[searchParam,setSearchParam]=useState('');const[tab,setTab]=useState('open');const[tabOpen,setTabOpen]=useState('open');const[newTicketModalOpen,setNewTicketModalOpen]=useState(false);//const [newTicketGroupModalOpen, setNewTicketGroupModalOpen] = useState(false);\nconst[showAllTickets,setShowAllTickets]=useState(false);const searchInputRef=useRef();const{user}=useContext(AuthContext);const{profile}=user;const[openCount,setOpenCount]=useState(0);const[pendingCount,setPendingCount]=useState(0);const userQueueIds=user.queues.map(q=>q.id);const[selectedQueueIds,setSelectedQueueIds]=useState(userQueueIds||[]);const[selectedTags,setSelectedTags]=useState([]);const[selectedUsers,setSelectedUsers]=useState([]);const[selectedDateRange,setSelectedDateRange]=useState({from:'',until:''});const[setClosedBox,setClosed]=useState(false);const[setGroupBox,setGroup]=useState(false);useEffect(()=>{async function fetchData(){var _settingIndex$;let settingIndex;try{const{data}=await api.get('/settings/');settingIndex=data.filter(s=>s.key==='viewclosed');}catch(err){toastError(err);}if(((_settingIndex$=settingIndex[0])===null||_settingIndex$===void 0?void 0:_settingIndex$.value)==='enabled'){setClosed(true);}else{if(user.profile==='admin'){setClosed(true);}else{setClosed(false);}}}fetchData();},[]);useEffect(()=>{async function fetchData(){var _settingIndex$2;let settingIndex;try{const{data}=await api.get('/settings/');settingIndex=data.filter(s=>s.key==='viewgroups');}catch(err){toastError(err);}if(((_settingIndex$2=settingIndex[0])===null||_settingIndex$2===void 0?void 0:_settingIndex$2.value)==='enabled'){setGroup(true);}else{if(user.profile==='admin'){setGroup(true);}else{setGroup(false);}}}fetchData();},[]);useEffect(()=>{if(user.profile.toUpperCase()==='ADMIN'){setShowAllTickets(true);}},[]);useEffect(()=>{if(tab==='search'){searchInputRef.current.focus();}},[tab]);let searchTimeout;const handleSelectedDate=(value,range)=>{setSelectedDateRange({...selectedDateRange,[range]:value});};const handleSearch=e=>{const searchedTerm=e.target.value.toLowerCase();clearTimeout(searchTimeout);if(searchedTerm===''){setSearchParam(searchedTerm);setTab('open');return;}searchTimeout=setTimeout(()=>{setSearchParam(searchedTerm);},500);};const handleChangeTab=(e,newValue)=>{setTab(newValue);};const handleSnackbarOpen=()=>{setSnackbarOpen(true);};const handleSnackbarClose=()=>{setSnackbarOpen(false);};const CloseAllTicket=async()=>{try{const{data}=await api.post(\"/tickets/closeAll\",{status:tabOpen,selectedQueueIds});handleSnackbarClose();}catch(err){console.log(\"Error: \",err);}};const handleChangeTabOpen=(e,newValue)=>{setTabOpen(newValue);};const applyPanelStyle=status=>{if(tabOpen!==status){return{width:0,height:0};}};const handleCloseOrOpenTicket=ticket=>{setNewTicketModalOpen(false);if(ticket!==undefined&&ticket.uuid!==undefined){history.push(`/tickets/${ticket.uuid}`);}};{/*const handleCloseOrOpenTicketGroup = (ticket) => {\n    setNewTicketGroupModalOpen(false);\n    if (ticket !== undefined && ticket.uuid !== undefined) {\n      history.push(`/tickets/${ticket.uuid}`);\n    }\n  };*/}const handleSelectedTags=selecteds=>{const tags=selecteds.map(t=>t.id);setSelectedTags(tags);};const handleSelectedUsers=selecteds=>{const users=selecteds.map(t=>t.id);setSelectedUsers(users);};return/*#__PURE__*/_jsxs(Paper,{elevation:0,variant:\"outlined\",className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsx(NewTicketModal,{modalOpen:newTicketModalOpen,onClose:ticket=>{// console.log('ticket', ticket);\nhandleCloseOrOpenTicket(ticket);}}),setClosedBox&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Paper,{elevation:0,square:true,className:classes.tabsHeader,children:/*#__PURE__*/_jsxs(Tabs,{value:tab,onChange:handleChangeTab,variant:\"fullWidth\",indicatorColor:\"primary\",textColor:\"primary\",\"aria-label\":\"icon label tabs example\",children:[/*#__PURE__*/_jsx(Tab,{value:'open',icon:/*#__PURE__*/_jsx(ChatIcon,{}),classes:{root:classes.tab}}),setGroupBox&&/*#__PURE__*/_jsx(Tab,{value:'group',icon:/*#__PURE__*/_jsx(GroupIcon,{}),classes:{root:classes.tab}}),/*#__PURE__*/_jsx(Tab,{value:'closed',icon:/*#__PURE__*/_jsx(DoneAllIcon,{}),classes:{root:classes.tab}}),/*#__PURE__*/_jsx(Tab,{value:'search',icon:/*#__PURE__*/_jsx(SearchIcon,{}),classes:{root:classes.tab}})]})})}),!setClosedBox&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Paper,{elevation:0,square:true,className:classes.tabsHeader,children:/*#__PURE__*/_jsxs(Tabs,{value:tab,onChange:handleChangeTab,variant:\"fullWidth\",indicatorColor:\"primary\",textColor:\"primary\",\"aria-label\":\"icon label tabs example\",children:[/*#__PURE__*/_jsx(Tab,{value:'open',icon:/*#__PURE__*/_jsx(ChatIcon,{}),classes:{root:classes.tab}}),setGroupBox&&/*#__PURE__*/_jsx(Tab,{value:'group',icon:/*#__PURE__*/_jsx(GroupIcon,{}),classes:{root:classes.tab}})]})})}),/*#__PURE__*/_jsxs(Paper,{square:true,elevation:0,className:classes.ticketOptionsBox,children:[tab==='search'?/*#__PURE__*/_jsxs(\"div\",{className:classes.serachInputWrapper,children:[/*#__PURE__*/_jsx(SearchIcon,{className:classes.searchIcon}),/*#__PURE__*/_jsx(InputBase,{className:classes.searchInput,inputRef:searchInputRef,placeholder:i18n.t('tickets.search.placeholder'),type:\"search\",onChange:handleSearch})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[(tab==='open'||tab==='closed')&&/*#__PURE__*/// Adiciona uma condição para exibir o botão em ambas as guias\n_jsx(Badge,{color:\"primary\",invisible:isHoveredAll||!isHoveredNew||isHoveredResolve||isHoveredOpen||isHoveredClosed,badgeContent:i18n.t(\"Novo\"),classes:{badge:classes.tabsBadge},children:/*#__PURE__*/_jsx(IconButton,{onMouseEnter:()=>setIsHoveredNew(true),onMouseLeave:()=>setIsHoveredNew(false),className:classes.button,onClick:()=>{setNewTicketModalOpen(true);},children:/*#__PURE__*/_jsx(AddIcon,{className:classes.icon})})}),/*#__PURE__*/_jsx(Snackbar,{open:snackbarOpen,onClose:handleSnackbarClose,message:i18n.t(\"tickets.inbox.closedAllTickets\"),ContentProps:{className:classes.snackbar},action:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{className:classes.yesButton,size:\"small\",onClick:CloseAllTicket,children:i18n.t(\"tickets.inbox.yes\")}),/*#__PURE__*/_jsx(Button,{className:classes.noButton,size:\"small\",onClick:handleSnackbarClose,children:i18n.t(\"tickets.inbox.no\")})]})}),user.profile===\"admin\"&&/*#__PURE__*/_jsx(Badge,{color:\"primary\",invisible:isHoveredAll||isHoveredNew||!isHoveredResolve||isHoveredOpen||isHoveredClosed,badgeContent:i18n.t(\"tickets.inbox.closedAll\"),classes:{badge:classes.tabsBadge},children:/*#__PURE__*/_jsx(IconButton,{onMouseEnter:()=>setIsHoveredResolve(true),onMouseLeave:()=>setIsHoveredResolve(false),className:classes.button,onClick:handleSnackbarOpen,children:/*#__PURE__*/_jsx(PlaylistAddCheckOutlinedIcon,{style:{color:\"green\"}})})}),/*#__PURE__*/_jsx(Can,{role:user.profile,perform:\"tickets-manager:showall\",yes:()=>/*#__PURE__*/_jsx(FormControlLabel,{label:i18n.t('tickets.buttons.showAll'),labelPlacement:\"start\",control:/*#__PURE__*/_jsx(Switch,{size:\"small\",checked:showAllTickets,onChange:()=>setShowAllTickets(prevState=>!prevState),name:\"showAllTickets\",color:\"primary\"})})})]}),/*#__PURE__*/_jsx(TicketsQueueSelect,{style:{marginLeft:6},selectedQueueIds:selectedQueueIds,userQueues:user===null||user===void 0?void 0:user.queues,onChange:values=>setSelectedQueueIds(values)})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tab,name:\"open\",className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsxs(Tabs,{value:tabOpen,onChange:handleChangeTabOpen,indicatorColor:\"primary\",textColor:\"primary\",variant:\"fullWidth\",children:[/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsx(Badge,{className:classes.badge,badgeContent:openCount,color:\"primary\",children:i18n.t('ticketsList.assignedHeader')}),value:'open'}),/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsx(Badge,{className:classes.badge,badgeContent:pendingCount,color:\"primary\",children:i18n.t('ticketsList.pendingHeader')}),value:'pending'})]}),/*#__PURE__*/_jsxs(Paper,{className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsx(TicketsList,{status:\"open\",showAll:showAllTickets,selectedQueueIds:selectedQueueIds,updateCount:val=>setOpenCount(val),style:applyPanelStyle('open')}),/*#__PURE__*/_jsx(TicketsList,{status:\"pending\",selectedQueueIds:selectedQueueIds,updateCount:val=>setPendingCount(val),style:applyPanelStyle('pending')})]})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tab,name:\"group\",className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsxs(Tabs,{value:tabOpen,onChange:handleChangeTabOpen,indicatorColor:\"primary\",textColor:\"primary\",variant:\"fullWidth\",children:[/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsx(Badge,{className:classes.badge,badgeContent:openCount,color:\"primary\",children:i18n.t('ticketsList.assignedHeader')}),value:'open'}),/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsx(Badge,{className:classes.badge,badgeContent:pendingCount,color:\"primary\",children:i18n.t('ticketsList.pendingHeader')}),value:'pending'})]}),/*#__PURE__*/_jsxs(Paper,{className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsx(TicketsListGroup,{status:\"open\",showAll:showAllTickets,selectedQueueIds:selectedQueueIds,updateCount:val=>setOpenCount(val),style:applyPanelStyle('open')}),/*#__PURE__*/_jsx(TicketsListGroup,{status:\"pending\",selectedQueueIds:selectedQueueIds,updateCount:val=>setPendingCount(val),style:applyPanelStyle('pending')})]})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tab,name:\"closed\",className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsx(TicketsList,{status:\"closed\",showAll:true,selectedQueueIds:selectedQueueIds}),setGroupBox&&/*#__PURE__*/_jsx(TicketsListGroup,{status:\"closed\",showAll:true,selectedQueueIds:selectedQueueIds})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tab,name:\"search\",className:classes.ticketsWrapper,children:[/*#__PURE__*/_jsx(TagsFilter,{onFiltered:handleSelectedTags}),profile==='admin'&&/*#__PURE__*/_jsx(UsersFilter,{onFiltered:handleSelectedUsers}),/*#__PURE__*/_jsx(TicketsList,{dateRange:selectedDateRange,searchParam:searchParam,showAll:true,tags:selectedTags,users:selectedUsers,selectedQueueIds:selectedQueueIds})]})]});};export default TicketsManagerTabs;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}