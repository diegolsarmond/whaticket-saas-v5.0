{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import Avatar from\"@material-ui/core/Avatar\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import Modal from\"@material-ui/core/Modal\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Button,Divider}from\"@material-ui/core\";import{useTheme}from\"@material-ui/core/styles\";// Importar useTheme\nimport NewTicketModal from\"../NewTicketModal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const VCardPreview=_ref=>{let{contact,numbers}=_ref;const history=useHistory();const{user}=useContext(AuthContext);const theme=useTheme();// Usar o hook useTheme para acessar o tema\nconst[selectedContact,setContact]=useState({name:\"\",number:0,profilePicUrl:\"\"});const[selectedQueue,setSelectedQueue]=useState(\"\");const[isModalOpen,setModalOpen]=useState(false);const[isContactValid,setContactValid]=useState(true);const[newTicketModalOpen,setNewTicketModalOpen]=useState(false);const[contactTicket,setContactTicket]=useState({});const handleQueueSelection=async queueId=>{setSelectedQueue(queueId);setModalOpen(false);if(queueId!==\"\"){await createTicket(queueId);}};const renderQueueModal=()=>{return/*#__PURE__*/_jsx(Modal,{open:isModalOpen,onClose:()=>setModalOpen(false),children:/*#__PURE__*/_jsxs(\"div\",{style:{position:\"absolute\",top:\"50%\",left:\"50%\",transform:\"translate(-50%, -50%)\",backgroundColor:theme.palette.background.paper,padding:\"20px\",outline:\"none\"},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Selecione a Fila\"}),user.queues.map(queue=>/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{onClick:()=>handleQueueSelection(queue.id),children:queue.name})},queue.id))]})});};useEffect(()=>{const fetchContacts=async()=>{try{let contactObj={name:contact,number:numbers.replace(/\\D/g,\"\"),email:\"\"};const{data}=await api.post(\"/contacts\",contactObj);if(data.alreadyExists){setContact(data.existingContact);}else{setContact(contactObj);}if(data.invalido){setContactValid(false);}}catch(err){toastError(err);}};const delayDebounceFn=setTimeout(fetchContacts,1500);return()=>clearTimeout(delayDebounceFn);},[contact,numbers]);const handleNewChat=()=>{if(selectedQueue===\"\"){setModalOpen(true);}else{createTicket();}};const createTicket=async queueId=>{try{let contactId=selectedContact.id;if(!contactId){const contactObj={name:selectedContact.name,number:selectedContact.number,email:\"\"};const{data}=await api.post(\"/contacts\",contactObj);contactId=data.existingContact.id;}const{data:ticket}=await api.post(\"/tickets\",{contactId,queueId,userId:user.id,status:\"open\"});history.push(`/tickets/${ticket.uuid}`);}catch(err){toastError(err);}};const handleCloseOrOpenTicket=ticket=>{setNewTicketModalOpen(false);if(ticket!==undefined&&ticket.uuid!==undefined){history.push(`/tickets/${ticket.uuid}`);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[renderQueueModal(),/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:\"250px\"},children:[/*#__PURE__*/_jsx(NewTicketModal,{modalOpen:newTicketModalOpen,initialContact:selectedContact,onClose:ticket=>{handleCloseOrOpenTicket(ticket);}}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:1,children:/*#__PURE__*/_jsx(Avatar,{src:selectedContact.profilePicUrl})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:9,children:/*#__PURE__*/_jsx(Typography,{style:{marginTop:\"12px\",marginLeft:\"10px\",color:theme.palette.text.vcard},variant:\"subtitle1\",gutterBottom:true,children:selectedContact.name})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:9,children:[/*#__PURE__*/_jsxs(Typography,{style:{marginLeft:\"10px\",color:theme.palette.text.vcard},variant:\"body2\",gutterBottom:true,children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Nome:\"}),\" \",selectedContact.name]}),/*#__PURE__*/_jsx(Typography,{style:{marginLeft:\"10px\",color:theme.palette.text.vcard},variant:\"body2\",gutterBottom:true,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",component:\"span\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Telefone:\"}),\" \",selectedContact.number]})})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Button,{fullWidth:true,color:\"theme.palette.text.vcard\",onClick:()=>{setContactTicket(selectedContact);setNewTicketModalOpen(true);},disabled:!selectedContact.number||!isContactValid,children:isContactValid?\"Conversar (Novo Ticket)\":\"CONTATO FORA DO WHATSAPP\"})]})]})]})]});};export default VCardPreview;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}