{"ast":null,"code":"import React,{useContext,useState,useEffect,useRef}from\"react\";import{useReactToPrint}from\"react-to-print\";import Paper from\"@material-ui/core/Paper\";import Container from\"@material-ui/core/Container\";import Grid from\"@material-ui/core/Grid\";import MenuItem from\"@material-ui/core/MenuItem\";import FormControl from\"@material-ui/core/FormControl\";import InputLabel from\"@material-ui/core/InputLabel\";import Select from\"@material-ui/core/Select\";import TextField from\"@material-ui/core/TextField\";import FormHelperText from\"@material-ui/core/FormHelperText\";import Typography from\"@material-ui/core/Typography\";import{Button}from\"@material-ui/core\";import SpeedIcon from\"@material-ui/icons/Speed\";import GroupIcon from\"@material-ui/icons/Group\";import AssignmentIcon from\"@material-ui/icons/Assignment\";import PersonIcon from\"@material-ui/icons/Person\";import CallIcon from\"@material-ui/icons/Call\";import MobileFriendlyIcon from\"@material-ui/icons/MobileFriendly\";import StoreIcon from\"@material-ui/icons/Store\";import RecordVoiceOverIcon from\"@material-ui/icons/RecordVoiceOver\";import GroupAddIcon from\"@material-ui/icons/GroupAdd\";import HourglassEmptyIcon from\"@material-ui/icons/HourglassEmpty\";import CheckCircleIcon from\"@material-ui/icons/CheckCircle\";import ForumIcon from\"@material-ui/icons/Forum\";import FilterListIcon from\"@material-ui/icons/FilterList\";import ClearIcon from\"@material-ui/icons/Clear\";import SendIcon from\"@material-ui/icons/Send\";import MessageIcon from\"@material-ui/icons/Message\";import AccessAlarmIcon from\"@material-ui/icons/AccessAlarm\";import TimerIcon from\"@material-ui/icons/Timer\";import{makeStyles}from\"@material-ui/core/styles\";import{grey,blue}from\"@material-ui/core/colors\";import{toast}from\"react-toastify\";import Chart from\"./Chart\";import ButtonWithSpinner from\"../../components/ButtonWithSpinner\";import CardCounter from\"../../components/Dashboard/CardCounter\";import TableAttendantsStatus from\"../../components/Dashboard/TableAttendantsStatus\";import{isArray}from\"lodash\";import{AuthContext}from\"../../context/Auth/AuthContext\";import useDashboard from\"../../hooks/useDashboard\";import useTickets from\"../../hooks/useTickets\";import useUsers from\"../../hooks/useUsers\";import useContacts from\"../../hooks/useContacts\";import useMessages from\"../../hooks/useMessages\";import{ChatsUser}from\"./ChartsUser\";import Filters from\"./Filters\";import{isEmpty}from\"lodash\";import moment from\"moment\";import{ChartsDate}from\"./ChartsDate\";import ChartsAppointmentsAtendent from\"./ChartsAppointmentsAtendent\";import ChartsRushHour from\"./ChartsRushHour\";import ChartsDepartamentRatings from\"./ChartsDepartamentRatings\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";const useStyles=makeStyles(theme=>({container:{paddingTop:theme.spacing(1),paddingBottom:theme.padding,paddingLeft:theme.spacing(1),paddingRight:theme.spacing(2)},fixedHeightPaper:{padding:theme.spacing(2),display:\"flex\",flexDirection:\"column\",height:240,overflowY:\"auto\",...theme.scrollbarStyles},cardAvatar:{fontSize:\"55px\",color:grey[500],backgroundColor:\"#ffffff\",width:theme.spacing(7),height:theme.spacing(7)},card:{padding:theme.spacing(1),display:\"flex\",overflow:\"hidden\",flexDirection:\"column\",height:120,// Altura menor\nbackgroundColor:theme.palette.type===\"dark\"?theme.palette.boxticket.main:theme.palette.primary.main,color:\"#fff\"},cardIcon:{fontSize:50,// Ícone menor\ncolor:\"#fff\"},cardTitle:{fontSize:\"15px\",// Tamanho menor para o título\nfontWeight:700},cardSubtitle:{fontSize:\"25px\",// Subtítulo ajustado\nfontWeight:600,color:theme.palette.contadordash.main},alignRight:{textAlign:\"right\"},fullWidth:{width:\"100%\"},selectContainer:{width:\"100%\",textAlign:\"left\"},iframeDashboard:{width:\"100%\",height:\"calc(100vh - 64px)\",border:\"none\"},container:{paddingTop:theme.spacing(4),paddingBottom:theme.spacing(4)},fixedHeightPaper:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:240},customFixedHeightPaper:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:120},customFixedHeightPaperLg:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\",height:\"100%\"},fixedHeightPaper2:{padding:theme.spacing(2),display:\"flex\",overflow:\"auto\",flexDirection:\"column\"}}));const Dashboard=()=>{const classes=useStyles();const pageToPrint=useRef(null);const[counters,setCounters]=useState({});const[attendants,setAttendants]=useState([]);const[period,setPeriod]=useState(0);const[filterType,setFilterType]=useState(1);const[dateFrom,setDateFrom]=useState(moment(\"1\",\"D\").format(\"YYYY-MM-DD\"));const[dateTo,setDateTo]=useState(moment().format(\"YYYY-MM-DD\"));const[loading,setLoading]=useState(false);const[visibleButtonsWithPrint,setVisibleButtonsWithPrint]=useState(true);const{find}=useDashboard();let newDate=new Date();let date=newDate.getDate();let month=newDate.getMonth()+1;let year=newDate.getFullYear();let now=`${year}-${month<10?`0${month}`:`${month}`}-${date<10?`0${date}`:`${date}`}`;const[showFilter,setShowFilter]=useState(false);const[queueTicket,setQueueTicket]=useState(false);const{user}=useContext(AuthContext);var userQueueIds=[];if(user.queues&&user.queues.length>0){userQueueIds=user.queues.map(q=>q.id);}useEffect(()=>{async function firstLoad(){await fetchData();}setTimeout(()=>{firstLoad();},1000);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);async function handleChangePeriod(value){setPeriod(value);}async function handleChangeFilterType(value){setFilterType(value);if(value===1){setPeriod(0);}else{setDateFrom(\"\");setDateTo(\"\");}}async function fetchData(){setLoading(true);let params={};if(period>0){params={days:period};}if(!isEmpty(dateFrom)&&moment(dateFrom).isValid()){params={...params,date_from:moment(dateFrom).format(\"YYYY-MM-DD\")};}if(!isEmpty(dateTo)&&moment(dateTo).isValid()){params={...params,date_to:moment(dateTo).format(\"YYYY-MM-DD\")};}if(Object.keys(params).length===0){toast.error(\"Parametrize o filtro\");setLoading(false);return;}const data=await find(params);setCounters(data.counters);if(isArray(data.attendants)){setAttendants(data.attendants);}else{setAttendants([]);}setLoading(false);}function formatTime(minutes){return moment().startOf(\"day\").add(minutes,\"minutes\").format(\"HH[h] mm[m]\");}const handlePrint=useReactToPrint({documentTitle:\"Impressão do Dashboard\",copyStyles:true,onBeforePrint:()=>{// console.log(\"before printing...\");\n// setVisibleButtonsWithPrint(false);\n},onAfterPrint:()=>{console.log(\"after printing...\");setVisibleButtonsWithPrint(true);},removeAfterPrint:true});const GetUsers=()=>{let count;let userOnline=0;attendants.forEach(user=>{if(user.online===true){userOnline=userOnline+1;}});count=userOnline===0?0:userOnline;return count;};const GetContacts=all=>{let props={};if(all){props={};}const{count}=useContacts(props);return count;};function renderFilters(){if(filterType===1){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(TextField,{label:\"Data Inicial\",type:\"date\",value:dateFrom,onChange:e=>setDateFrom(e.target.value),className:classes.fullWidth,InputLabelProps:{shrink:true}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsx(TextField,{label:\"Data Final\",type:\"date\",value:dateTo,onChange:e=>setDateTo(e.target.value),className:classes.fullWidth,InputLabelProps:{shrink:true}})})]});}else{return/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsxs(FormControl,{className:classes.selectContainer,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"period-selector-label\",children:\"Per\\xEDodo\"}),/*#__PURE__*/_jsxs(Select,{labelId:\"period-selector-label\",id:\"period-selector\",value:period,onChange:e=>handleChangePeriod(e.target.value),children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:\"Nenhum selecionado\"}),/*#__PURE__*/_jsx(MenuItem,{value:3,children:\"\\xDAltimos 3 dias\"}),/*#__PURE__*/_jsx(MenuItem,{value:7,children:\"\\xDAltimos 7 dias\"}),/*#__PURE__*/_jsx(MenuItem,{value:15,children:\"\\xDAltimos 15 dias\"}),/*#__PURE__*/_jsx(MenuItem,{value:30,children:\"\\xDAltimos 30 dias\"}),/*#__PURE__*/_jsx(MenuItem,{value:60,children:\"\\xDAltimos 60 dias\"}),/*#__PURE__*/_jsx(MenuItem,{value:90,children:\"\\xDAltimos 90 dias\"})]}),/*#__PURE__*/_jsx(FormHelperText,{children:\"Selecione o per\\xEDodo desejado\"})]})});}}return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(Container,{ref:pageToPrint,maxWidth:\"lg\",className:classes.container,children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,justifyContent:\"flex-end\",children:[user.super&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:4,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"Conex\\xF5es Ativas\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:counters.totalWhatsappSessions})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(MobileFriendlyIcon,{className:classes.cardIcon})})]})})}),user.super&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:4,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"Empresas\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:counters.totalCompanies})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(StoreIcon,{className:classes.cardIcon,style:{color:\"#FFFFFF\"}})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:4,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"Em Conversa\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:counters.supportHappening})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(CallIcon,{className:classes.cardIcon})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:6,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"Aguardando\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:counters.supportPending})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(HourglassEmptyIcon,{className:classes.cardIcon})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:6,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"Novos Contatos\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:GetContacts(true)})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(GroupAddIcon,{className:classes.cardIcon})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:6,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"T.M. de Conversa\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:formatTime(counters.avgSupportTime)})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(AccessAlarmIcon,{className:classes.cardIcon})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,elevation:6,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"Finalizados\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:counters.supportFinished})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(CheckCircleIcon,{className:classes.cardIcon})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Paper,{className:classes.card,style:{overflow:\"hidden\"},elevation:6,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,alignItems:\"center\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:8,children:[/*#__PURE__*/_jsx(Typography,{component:\"h3\",variant:\"subtitle1\",className:classes.cardTitle,children:\"T.M. de Espera\"}),/*#__PURE__*/_jsx(Typography,{component:\"h1\",variant:\"h6\",className:classes.cardSubtitle,children:formatTime(counters.avgWaitTime)})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:4,children:/*#__PURE__*/_jsx(TimerIcon,{className:classes.cardIcon})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:4,children:/*#__PURE__*/_jsxs(FormControl,{className:classes.selectContainer,children:[/*#__PURE__*/_jsx(InputLabel,{id:\"period-selector-label\",children:\"Tipo de Filtro\"}),/*#__PURE__*/_jsxs(Select,{labelId:\"period-selector-label\",value:filterType,onChange:e=>handleChangeFilterType(e.target.value),children:[/*#__PURE__*/_jsx(MenuItem,{value:1,children:\"Filtro por Data\"}),/*#__PURE__*/_jsx(MenuItem,{value:2,children:\"Filtro por Per\\xEDodo\"})]}),/*#__PURE__*/_jsx(FormHelperText,{children:\"Selecione o per\\xEDodo desejado\"})]})}),renderFilters(),visibleButtonsWithPrint&&/*#__PURE__*/_jsxs(\"div\",{style:{display:\"flex\",flexDirection:\"row\",gap:8},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,className:classes.alignRight,children:/*#__PURE__*/_jsx(ButtonWithSpinner,{loading:loading,onClick:()=>fetchData(),variant:\"contained\",color:\"primary\",children:\"Filtrar\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,className:classes.alignRight,children:/*#__PURE__*/_jsx(ButtonWithSpinner,{loading:loading,onClick:()=>{setVisibleButtonsWithPrint(false);setTimeout(()=>handlePrint(null,()=>pageToPrint.current),500);},variant:\"contained\",color:\"primary\",children:\"Imprimir\"})})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:attendants.length?/*#__PURE__*/_jsx(TableAttendantsStatus,{attendants:attendants,loading:loading}):null}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Paper,{className:classes.fixedHeightPaper2,children:/*#__PURE__*/_jsx(ChatsUser,{})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Paper,{className:classes.fixedHeightPaper2,children:/*#__PURE__*/_jsx(ChartsDate,{})})})]}),/*#__PURE__*/_jsx(ChartsAppointmentsAtendent,{}),/*#__PURE__*/_jsx(ChartsRushHour,{}),/*#__PURE__*/_jsx(ChartsDepartamentRatings,{})]})});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}